# 故事数据结构指南

## 概述

本指南详细说明了互动小说系统的故事数据结构，帮助开发者快速创建新的互动故事。

## 数据结构概览

```javascript
const storyData = {
    // 故事基本信息
    title: "故事标题",
    author: "作者名称",
    description: "故事描述",
    
    // 特征值显示配置
    statsConfig: [...],
    
    // 初始状态
    initialState: {...},
    
    // 场景数据
    scenes: {...}
}
```

## 1. 故事基本信息

### title（必需）
- **类型**: String
- **说明**: 故事的标题
- **示例**: `"峨眉山奇遇"`

### author（必需）
- **类型**: String
- **说明**: 故事的作者
- **示例**: `"酒煮三江看五岳"`

### description（可选）
- **类型**: String
- **说明**: 故事的简短描述
- **示例**: `"在峨眉山，两个素不相识的灵魂在星光下相遇，许下了一个改变一生的约定"`

## 2. 特征值显示配置（statsConfig）

### 配置说明
`statsConfig` 数组定义了游戏中需要显示的特征值，每个特征值包含以下属性：

#### label（必需）
- **类型**: String
- **说明**: 特征值的显示标签
- **示例**: `"关系值"`

#### key（必需）
- **类型**: String
- **说明**: 特征值在游戏状态中的键名
- **示例**: `"relationship"`

#### type（必需）
- **类型**: String
- **可选值**: `"number"` 或 `"traits"`
- **说明**: 特征值的类型
  - `"number"`: 数值型特征值，直接显示数值
  - `"traits"`: 特质型特征值，显示激活的特质列表

### 配置示例

#### 示例1：恋爱游戏
```javascript
statsConfig: [
    {
        label: "关系值",
        key: "relationship",
        type: "number"
    },
    {
        label: "特质",
        key: "traits",
        type: "traits"
    }
]
```

#### 示例2：冒险游戏
```javascript
statsConfig: [
    {
        label: "生命值",
        key: "health",
        type: "number"
    },
    {
        label: "金币",
        key: "gold",
        type: "number"
    },
    {
        label: "装备",
        key: "equipment",
        type: "traits"
    }
]
```

#### 示例3：悬疑游戏
```javascript
statsConfig: [
    {
        label: "线索",
        key: "clues",
        type: "number"
    },
    {
        label: "时间",
        key: "time",
        type: "number"
    },
    {
        label: "状态",
        key: "status",
        type: "traits"
    }
]
```

## 3. 初始状态（initialState）

### 配置说明
`initialState` 对象定义了游戏开始时的初始状态，必须包含所有在 `statsConfig` 中定义的特征值。

### 基础属性

#### playerName（必需）
- **类型**: String
- **说明**: 玩家的默认名称
- **示例**: `"旅行者"`

#### currentScene（必需）
- **类型**: String
- **说明**: 游戏开始的场景名称
- **示例**: `"start"`

#### unlockedEndings（必需）
- **类型**: Array
- **说明**: 已解锁的结局列表
- **示例**: `[]`

#### visitedScenes（必需）
- **类型**: Array
- **说明**: 已访问的场景列表
- **示例**: `[]`

### 特征值属性

根据 `statsConfig` 的配置，需要添加相应的特征值属性。

#### 数值型特征值（type: "number"）
- **类型**: Number
- **说明**: 数值的初始值
- **示例**: `relationship: 0`

#### 特质型特征值（type: "traits"）
- **类型**: Object
- **说明**: 特质对象，键为特质名称，值为布尔值
- **示例**:
```javascript
traits: {
    patience: false,
    courage: false,
    compassion: false,
    art: false,
    wisdom: false
}
```

### 完整示例

```javascript
initialState: {
    playerName: "旅行者",
    currentScene: "start",
    relationship: 0,
    traits: {
        patience: false,
        courage: false,
        compassion: false,
        art: false,
        wisdom: false
    },
    unlockedEndings: [],
    visitedScenes: []
}
```

## 4. 场景数据（scenes）

### 场景对象结构

每个场景对象包含以下属性：

#### background（可选）
- **类型**: String
- **说明**: 背景图片路径
- **示例**: `"images/cover.jpg"`

#### text（必需）
- **类型**: String
- **说明**: 场景的文本内容，支持 HTML
- **示例**:
```javascript
text: `
    <p>清晨的薄雾如轻纱般笼罩着峨眉山...</p>
    <p>你站在山脚下，仰望着那若隐若现的山峰...</p>
`
```

#### choices（必需）
- **类型**: Array
- **说明**: 玩家的选择项列表
- **示例**:
```javascript
choices: [
    {
        text: "选择文本",
        nextScene: "目标场景名",
        effects: {
            relationship: 5,
            traits: { art: true }
        }
    }
]
```

### 选择项属性

#### text（必需）
- **类型**: String
- **说明**: 选择项的显示文本，支持 HTML
- **示例**: `"是的，我是来拍摄峨眉山的美景的"`

#### nextScene（必需）
- **类型**: String
- **说明**: 选择后跳转到的场景名称
- **示例**: `"photographer"`

#### effects（可选）
- **类型**: Object
- **说明**: 选择后的效果，根据 `statsConfig` 配置
- **示例**:
```javascript
effects: {
    relationship: 5,
    traits: { art: true }
}
```

### 完整场景示例

```javascript
start: {
    background: "",
    text: `
        <p>清晨的薄雾如轻纱般笼罩着峨眉山...</p>
        <p>你站在山脚下，仰望着那若隐若现的山峰...</p>
    `,
    choices: [
        {
            text: "是的，我是来拍摄峨眉山的美景的",
            nextScene: "photographer",
            effects: { relationship: 5 }
        },
        {
            text: "只是个业余爱好者，你呢？",
            nextScene: "amateur",
            effects: { relationship: 3 }
        }
    ]
}
```

## 5. 完整示例

```javascript
const storyData = {
    // 故事基本信息
    title: "峨眉山奇遇",
    author: "酒煮三江看五岳",
    description: "在峨眉山，两个素不相识的灵魂在星光下相遇，许下了一个改变一生的约定",
    
    // 特征值显示配置
    statsConfig: [
        {
            label: "关系值",
            key: "relationship",
            type: "number"
        },
        {
            label: "特质",
            key: "traits",
            type: "traits"
        }
    ],
    
    // 初始状态
    initialState: {
        playerName: "旅行者",
        currentScene: "start",
        relationship: 0,
        traits: {
            patience: false,
            courage: false,
            compassion: false,
            art: false,
            wisdom: false
        },
        unlockedEndings: [],
        visitedScenes: []
    },
    
    // 场景数据
    scenes: {
        start: {
            background: "",
            text: `
                <p>清晨的薄雾如轻纱般笼罩着峨眉山...</p>
            `,
            choices: [
                {
                    text: "是的，我是来拍摄峨眉山的美景的",
                    nextScene: "photographer",
                    effects: { relationship: 5 }
                }
            ]
        },
        photographer: {
            text: `
                <p>"哇，专业摄影师！"女孩的眼睛瞬间亮了起来...</p>
            `,
            choices: [
                {
                    text: "当然，我很乐意与你同行",
                    nextScene: "together",
                    effects: { relationship: 10 }
                }
            ]
        }
    }
};
```

## 6. 最佳实践

### 6.1 场景命名
- 使用小写字母和连字符
- 保持简洁但有意义
- 例如：`"start"`, `"photographer"`, `"together"`

### 6.2 特质设计
- 特质名称使用小写字母
- 特质应该反映玩家的行为模式
- 例如：`"patience"`, `"courage"`, `"art"`

### 6.3 效果平衡
- 数值型特征值的变化应该合理
- 特质激活应该有意义
- 避免一次性给予过多奖励

### 6.4 场景流程
- 确保每个场景都有选择项
- 避免死胡同场景
- 提供返回或重新开始的选项

### 6.5 文本内容
- 使用 HTML 格式化文本
- 保持段落简洁
- 使用引号区分对话

## 7. 常见问题

### Q1: 如何添加新的特征值？
在 `statsConfig` 中添加新的配置项，并在 `initialState` 中添加对应的初始值。

### Q2: 如何创建结局场景？
创建一个没有选择项的场景，或者选择项指向 `"start"` 场景以重新开始。

### Q3: 如何处理条件分支？
在场景文本中使用 JavaScript 动态生成内容，或在选择项中使用条件判断。

### Q4: 如何调试故事？
使用浏览器开发者工具查看控制台输出，检查游戏状态变化。

## 8. 文件结构

```
故事目录/
├── index.html          # 主页面（模板）
├── story.css          # 样式文件（通用）
├── game.js            # 游戏逻辑（通用）
└── story-data.js      # 故事数据（自定义）
```

## 9. 扩展阅读

- [互动小说设计原则](#)
- [游戏平衡性指南](#)
- [叙事技巧参考](#)

---

**版本**: 1.0  
**更新日期**: 2025-12-29  
**维护者**: 开发团队
